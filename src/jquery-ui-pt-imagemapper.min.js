/* Copyright (c) 2015 Planet Telex Inc. all rights reserved. Licence: http://www.apache.org/licenses/LICENSE-2.0 */
"undefined"!=typeof jQuery&&"undefined"!=typeof jQuery.ui&&function(t){t.widget("pt.imagemapper",{widgetEventPrefix:"pt.imagemapper",_create:function(){this._registerEvents()},destroy:function(){this._$divContainer.remove(),t.Widget.prototype.destroy.call(this)},_$divControls:t("<div class='imagemapper-controls'></div>"),_$lblInstructions:t("<h6 class='imagemapper-instructions'>Start by giving your map a name.</h6>"),_$lblMapName:t("<strong>Map Name: </strong>"),_$txtMapName:t("<input type='text' />"),_$divMapName:t("<div class='imagemapper-mapName-controls'></div>"),_$lblMapShape:t("<strong>Map Shape: </strong>"),_$rdoMapShapeRect:t("<input name='mapShape' type='radio' checked='checked' />"),_$lblMapShapeRect:t("<label>Rectangle</label>"),_$rdoMapShapeCircle:t("<input name='mapShape' type='radio' />"),_$lblMapShapeCircle:t("<label>Circle</label>"),_$rdoMapShapePoly:t("<input name='mapShape' type='radio' />"),_$lblMapShapePoly:t("<label>Polygon</label>"),_$divMapShape:t("<div class='imagemapper-mapShape-controls'></div>"),_$lblMapUrl:t("<strong>Map URL: </strong>"),_$txtMapUrl:t("<input type='text' />"),_$divMapUrl:t("<div class='imagemapper-mapUrl-controls'></div>"),_$btnStartStop:t("<input type='button' value='Start' />"),_$btnReset:t("<input type='button' value='Reset' />"),_$divButtons:t("<div class='imagemapper-buttons'></div>"),_$hdnCoordinates:t("<input type='hidden' />"),_$lblImageTag:t("<pre></pre>"),_$lblMapStartTag:t("<pre></pre>"),_$lblMapEndTag:t("<pre></pre>"),_$imageMap:t("<pre></pre>"),_$divResults:t("<div class='imagemapper-results'></div>"),_$divContainer:t("<div class='imagemapper'></div>"),_isMapping:!1,_clickNumber:0,_shape:"rect",_mapName:"myImageMap",_picWidth:0,_picHeight:0,_buildMarkup:function(){this.element.wrap(this._$divContainer.css("width",this._picWidth+"px")),this._$divMapName.append(this._$lblMapName),this._$divMapName.append(this._$txtMapName),this._$divMapShape.append(this._$lblMapShape),this._$divMapShape.append(this._$rdoMapShapeRect),this._$divMapShape.append(this._$lblMapShapeRect),this._$divMapShape.append(this._$rdoMapShapeCircle),this._$divMapShape.append(this._$lblMapShapeCircle),this._$divMapShape.append(this._$rdoMapShapePoly),this._$divMapShape.append(this._$lblMapShapePoly),this._$divMapUrl.append(this._$lblMapUrl),this._$divMapUrl.append(this._$txtMapUrl),this._$divButtons.append(this._$btnStartStop),this._$divButtons.append(this._$btnReset),this._$divControls.append(this._$lblInstructions),this._$divControls.append(this._$divMapName),this._$divControls.append(this._$divMapUrl),this._$divControls.append(this._$divMapShape),this._$divControls.append(this._$divButtons),this._$divControls.append(this._$hdnCoordinates),this.element.before(this._$divControls),this._$divResults.append(this._$lblImageTag),this._$divResults.append(this._$lblMapStartTag),this._$divResults.append(this._$imageMap),this._$divResults.append(this._$lblMapEndTag),this.element.after(this._$divResults)},_registerEvents:function(){this.element.bind("load",this._imageLoad.bind(this)),this.element.bind("click",this._imageClick.bind(this)),this._$rdoMapShapeRect.bind("click",this._rectClick.bind(this)),this._$lblMapShapeRect.bind("click",this._rectLabelClick.bind(this)),this._$rdoMapShapeCircle.bind("click",this._circleClick.bind(this)),this._$lblMapShapeCircle.bind("click",this._circleLabelClick.bind(this)),this._$rdoMapShapePoly.bind("click",this._polyClick.bind(this)),this._$lblMapShapePoly.bind("click",this._polyLabelClick.bind(this)),this._$btnStartStop.bind("click",this._startStopClick.bind(this)),this._$btnReset.bind("click",this._resetClick.bind(this)),this._$txtMapName.bind("keyup",this._mapNameChange.bind(this))},_imageLoad:function(t){this._picHeight=t.target.height,this._picWidth=t.target.width,this._buildMarkup()},_imageClick:function(t){if(this._isMapping){this._clickNumber++;var i=this._$hdnCoordinates.val(),a=t.pageX-this.element.offset().left,e=t.pageY-this.element.offset().top;""!=i&&(i+=","),2==this._clickNumber&&"circle"==this._shape?i+=this._calculateRadius(a,e):i=i+a+","+e,this._$hdnCoordinates.val(i),this._clickNumber>=2&&("rect"==this._shape||"circle"==this._shape)&&this._stopMapping(),this._writeInstructions()}},_rectClick:function(){this._shape="rect"},_rectLabelClick:function(){this._$rdoMapShapeRect.click()},_circleClick:function(){this._shape="circle"},_circleLabelClick:function(){this._$rdoMapShapeCircle.click()},_polyClick:function(){this._shape="poly"},_polyLabelClick:function(){this._$rdoMapShapePoly.click()},_startStopClick:function(){"Stop"==this._$btnStartStop.val()?this._stopMapping():(this._buildMapTags(),this._startMapping())},_resetClick:function(){this._stopMapping(),this._resetMapper()},_mapNameChange:function(){this._mapName=this._$txtMapName.val(),this._buildMapTags(),this._writeInstructions()},_startMapping:function(){this._isMapping=!0,this._$btnStartStop.val("Stop"),this._writeInstructions()},_stopMapping:function(){this._updateResults(),this._isMapping=!1,this._clickNumber=0,this._$btnStartStop.val("Start"),this._$hdnCoordinates.val(""),this._writeInstructions()},_resetMapper:function(){this._$lblImageTag.empty(),this._$lblMapStartTag.empty(),this._$lblMapEndTag.empty(),this._$imageMap.empty(),this._writeInstructions()},_buildMapTags:function(){var t=this.element.attr("src"),i="&lt;img alt='' src='"+t+"' usemap='#"+this._mapName+"' /&gt;",a="&lt;map id='"+this._mapName+"' name='"+this._mapName+"' &gt;",e="&lt;/map&gt;";this._$lblImageTag.html(i),this._$lblMapStartTag.html(a),this._$lblMapEndTag.html(e)},_updateResults:function(){var t=this._$hdnCoordinates.val(),i=this._$txtMapUrl.val(),a="&nbsp;&nbsp;&nbsp;&lt;area alt='' shape='"+this._shape+"' coords='"+t+"' href='"+i+"' /&gt;";this._$imageMap.append(a),this._$imageMap.append("<br/>"),this._trigger("markupupdated")},_calculateRadius:function(t,i){var a=this._$hdnCoordinates.val().split(",")[0],e=this._$hdnCoordinates.val().split(",")[1],p=Math.pow(t-a,2),s=Math.pow(i-e,2);return Math.round(Math.sqrt(p+s))},_writeInstructions:function(){if(this._isMapping||0!=this._clickNumber){if(this._isMapping&&0==this._clickNumber)this._$lblInstructions.html("rect"==this._shape?"Click the top left corner of the rectangle area.":"circle"==this._shape?"Click the center of the circle area.":"Click the starting point of the polygon area.");else if(this._isMapping&&1==this._clickNumber)this._$lblInstructions.html("rect"==this._shape?"Click the bottom right corner of the rectangle area.":"circle"==this._shape?"Click anywhere along the circle area's edge.":"Click the second point of the polygon area.");else if(this._isMapping&&this._clickNumber>=2){var t=this._clickNumber+1;this._$lblInstructions.html("Click point "+t+" of the polygon area, or 'Stop' to finish mapping the area.")}}else this._$lblInstructions.html("myImageMap"==this._mapName?"Start by giving your map a name.":"Click 'Start' to begin creating a map area, specifying the appropriate shape and URL.")}})}(jQuery);